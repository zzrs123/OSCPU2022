# ysyx-preLearning3

数字电路基础实验。

这里主要是实验完成记录和实验报告，verilog以及其他知识的学习会单列笔记。这里课程给出的资源比较多，慢慢学。

## 0. 资源整理

## 1. lab1:mux

### 1.1 阅读手册

* 多路选择器从多路输入中，选取其中一路将其传送到输出端，由选择控制信号决定输出的是第几路输入信号。
* 数字电路中存在大量的并行运算，通常的设计思路是使用电路同时生成所有可能用到的数字信号，再利用选择器选择最终输出哪一路信号。

> 这里看实验手册突然来了个卡诺图，感觉数字逻辑的知识忘记的有点多了。

波形仿真这里NJU是采用Multisim进行，我们这里自然是接入NVBoard了。

> 别人家的实验手册啊，讲的挺清楚。很喜欢这个实验手册的表述。

这里手册上提到初学者不要使用行为建模方式设计电路，因为这种方式太像面向过程编程，不能很好地培养硬件思维。**真正的描述电路 = 实例化 + 连线。**

* HDL设计电路，就是在用HDL来描述电路图纸，图纸上有什么，就直接描述什么。所以，用HDL描述电路，无非是做两件事情：
  * 实例化：在电路板上放一个元件/模块，可以是一个门电路，或者是由门电路组成的模块
  * 连线：用导线将元件/模块的引脚正确地连起来
* 所以数据流建模方式是处于输入输出信号的逻辑关系（表达式）来描述电路，而结构化建模则是实例化电路中的所有器件，再将其连接起来，完成电路。
* 而行为建模方式就绕了一个远路，拿到电路，先在脑子里想它的工作行为，然后写出这个工作行为的代码，别人拿到代码，翻译出工作行为，再转换为电路。

### 1.2 验收内容

二位四选一选择器

用选择器模板实现一个2位4选1的选择器，如下图所示，选择器有5个2位输入端，分别为X0, X1, X2, X3和Y，输出端为F；X0, X1,X2, X3是四个2位的输入变量。输出F端受控制端Y的控制，选择其中的一个X输出，当Y = 00时，输出端输出X0，即F = X0；当Y =01时，输出端输出X1，即F = X1；以此类推。

![1681115121083](pics/prelearn3/lab1-mux.png)

选择开发板上的SW0和SW1作为控制端Y，SW2—SW9作为四个两位数据输入端X0–X3，将两位的输出端F接到发光二极管LEDR0和LEDR1上显示输出，完成设计，对自己的设计进行功能仿真，并下载到开发板上验证电路性能。

### 1.3 完成实验

![lab1](pics/prelearn3/lab1-result.png)

随机把SW2~SW9按下，置位控制信号Y为01，也就是选择输入信号X2作为输出，X2此时为01，而可见两位LED灯的亮灭情况就是01。

## 2. lab2:dec&enc

### 2.1 阅读手册

译码器是将某一输入信息转换为某一特定输出的逻辑电路，将 m 位的输入编码转换为 n 位的编码输出。然后实验手册开始介绍2-4译码器和3-8译码器。之后讲解了对应的编码器。

不得不记录七段数码管的显示方式：

![1](pics/prelearn3/lab2-led.png)

### 2.2 验收内容

实现一个8-3优先编码器并在七段数码管上显示。

### 2.3 完成实验

下图可以清晰看到优先级，比5低的码位都会被屏蔽。

![2](pics/prelearn3/lab2-enc-led.png)

## 3. lab3: ALU

### 3.1 阅读手册

* 一位全加器

  就是根据加法的逻辑用基本的逻辑器件搭起来的。
* 串行进位加法器

  将全加器串在一起，adder全加器是底层模块，top里使其连起来。[参考](https://blog.csdn.net/Enoshima/article/details/112951166)
* n位加法器（更多位）

  ```
  out_s = in_x + in_y;
  ```

  定义了可以生成n位加法器的电路，但是该加法器电路并不包含加法过程中产生的进位输出信号和算术溢出信号。
  需要增加溢出信号和进位信号。
* 加减法运算器设计
  ![1](pics/prelearn3/lab3-addsub.png)

  输入信号有：两个32位的参与运算的数据的补码操作数A和操作数B，一个控制做加法还是做减法的加/减控制端Sub/Add，为1时进行减法运算。输出信号有：一个32位的结果Result、一位进位位，一位溢出位和一位判断结果是否为零的输出位。

  注意这里已经进行了减法中B的取补码，就是受加减控制信号控制下的XOR。B^0=B，B^1=-B

### 3.2 验收内容

### 3.3 完成实验

## 4. lab4: counter

计数器常用来记录系统的工作状态。

> 话说lab4好像没有要求写。

### 4.1 阅读手册

#### A. 计数器

* 加法计数器
  ![img](pics/prelearn3/lab4-counter01.png)
* 减法计数器
  ![1](pics/prelearn3/lab4-counter02.png)

**3位二进制带使能端的减法计数器代码**

```verilog
module vminus3(clk,en,out_q);
  input  clk;
  input  en;
  output reg [2:0] out_q;

  always @ (posedge clk)
    if (en)   out_q <= out_q -1;
    else   out_q <= 0;
endmodule
```

构建的减法计数器的仿真图如图 [Fig. 26](https://nju-projectn.github.io/dlco-lecture-note/exp/04.html#fig-countersim) 所示。

![../_images/countersim.png](https://nju-projectn.github.io/dlco-lecture-note/_images/countersim.png)

#### B. 定时器

**如果在计数器的时钟输入端输入一个固定周期的时钟，那么计数器就变成了定时器。** 利用开发板上提供的频率为50MHz时钟信号和定时器，我们可以设计任何我们需要的时钟信号。如下实例是产生周期为1秒的时钟信号的参考代码。其中clk是系统时钟，clk_1s 是产生的周期为1秒的时钟：

```verilog
always @(posedge clk)
  if(count_clk==24999999)
  begin
    count_clk <=0;
    clk_1s <= ~clk_1s;
  end
  else
    count_clk <= count_clk+1;
```

这里思考为了能满足  0~24999999的计数要求，变量 `count_clk` 的宽度如何设定？

* 其实就是寻找次方项：2 的25次方==33554432 > 24999999.如果要表达为信号位宽，则是26位宽

### 4.2 验收内容

实现一个计时器，在七段数码管上直接以十进制显示。

* 利用开发板上的频率为50MHz的时钟，请先设计一个分频器，其输入为50MHz的时钟，输出为一个频率为1Hz，周期为1秒的时钟信号。再用这个新的频率为1Hz的时钟信号作为你设计的时钟信号，进行计数。
* 要求此计时器有开始、暂停和清零功能，要求从00计数到99，计数值到99后重新从零开始计数。在数码管上用两位数字显示。
* 可以在计时结束的时候让某一个发光二极管闪烁一个时钟周期，提示计时结束。
* > 拓展：在DE-10 Standard开发板上实现一个电子时钟，时钟要求能够显示时、分、秒；还可以有以下功能：调整时间；闹铃（在特定时间LED闪烁）；秒表（提供百分之一秒精度，可以停止重启）等。
  >

### 4.3 完成实验

感觉这个实验挺有难度，比较综合，我的想法也比较多。

* 首先一个分频器，这个没什么说的，注意线宽。
* 接着计数器模块。用级联的思想实现00~99的计数，并且需要实现循环计数。
  control信号设计为独热码：001开始，010中止，100结束。
* 这个计数器分别输出到对应的数码管模块，也就是还需要两个数码管模块。
* 在top的timer模块将它们连接起来。

实现效果如下图：截取的时刻是刚跑完一次00~99，此时LD0亮起，表示一次计数结束，我让他亮了3秒。而下面的SW开关，我设置的是001开始，010暂停，100清零。

![img](pics/prelearn3/lab4-timer.png)

折腾了半个下午，终于心满意足啦！！

不过这个题让我有个疑惑，那就是，rst的管脚不能绑定？就是那个RST，而参考verilator环节的流水灯代码，rst写在了cpp里， 突然发现这里自己并不理解为什么这样子做。
